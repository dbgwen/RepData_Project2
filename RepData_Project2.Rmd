---
title: "RepData_Project2"
author: "Deborah Passey"
date: "6/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction  

Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.This project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database.


# Data Processing

This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage. 

```{r, loading data, include=FALSE}
    library("data.table")
    url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
    download.file(url, "StormData.csv.bz2")
    library(R.utils)
    bunzip2("StormData.csv.bz2", "StormData.csv")
    storm_data1 <- read.csv("StormData.csv")
    library(dplyr)
    storm_data2 <- select(storm_data1, EVTYPE, FATALITIES, INJURIES) 
    storm_data3 <- select(storm_data1, EVTYPE, PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP)
   
```

  
# Results  


## 1. Across the United States, which types of events are most harmful with respect to population health?  

This subset of data looks at the top five weather events resulting in injuries and fatalities. A direct fatality or injury is defined as a fatality or injury directly attributable to the hydro-meteorological event itself, or impact by airborne/falling/moving debris, i.e., missiles generated by wind, water, ice, lightning, tornado, etc. Indirect injuries may be entered into a field within the Storm Data software, but they will not be tallied in official Storm Data statistics.  
    
    
```{r, top five events for injuries and fatalities}
    library(dplyr)
    fatalities <- storm_data2 %>% group_by(EVTYPE) %>% mutate(total_fatalities = INJURIES + FATALITIES)
    harmful <- fatalities %>% group_by(EVTYPE) %>% summarise(total_harm = sum(total_fatalities))
    arrange(harmful, desc(total_harm))
    topfive <- head(arrange(harmful,desc(total_harm)), 5)
```
    
    
    ### Figure 1. Bar graph of total injuries and fatalities by weather event
```{r, Figure 1, fig.height=4, fig.width=8}
    library(ggplot2)
    g1 <- ggplot(topfive, aes(x = reorder(EVTYPE, -total_harm), y = total_harm)) + geom_bar(stat="Identity", fill="royalblue") + theme_light(base_size = 11, base_family = "sans", base_line_size =1, base_rect_size = 1) + geom_text(aes(label=total_harm)) + xlab("Weather Event") + ylab("Fatalities and Injuries") + ggtitle("Top Five Weather Events for Total Injuries and Fatalities")
    print(g1)

``` 
## 2. Across the United States, which types of events have the greatest economic consequences?  

Typically, damage refers to damage inflicted to private property (structures, objects, vegetation)
as well as public infrastructure and facilities. Crop damage refers to damage from freezing temperature, hail, wind, and other weather events that result in damaged crops. Property and Crop damage is considered as a broad estimate.

```{r, Top five events for damages}
        library(dplyr)
        character <- sort(unique(as.character(storm_data3$PROPDMGEXP)))
        exp <- c(0,0,0,1,10,10,10,10,10,10,10,10,10,10^9,10^2,10^2,10^3,10^6,10^6)
        multiplier <- data.frame(character, exp)
        
        storm_data3$property<- multiplier$exp[match(storm_data3$PROPDMGEXP, multiplier$character)]
        storm_data3$crop <- multiplier$exp[match(storm_data3$CROPDMGEXP, multiplier$character)]
        storm_data3 <- storm_data3 %>% mutate(PROPDMG = PROPDMG*property) %>% mutate(CROPDMG = CROPDMG*crop) %>% mutate(total_damage = PROPDMG+CROPDMG)
        damage <- storm_data3 %>% group_by(EVTYPE) %>% summarize(damage_by_event = sum(total_damage))%>% arrange(-damage_by_event)
       
        topfive_events <- head(arrange(damage,desc(damage_by_event)), 5)
        head(topfive_events)
```
  
  
    ### Figure 2. Top five events causing monetray damages (US$) to property and crops 
```{r, Figure 2, fig.height=4, fig.width=8}
    library(ggplot2)
     g2 <- ggplot(topfive_events, aes(x = reorder(EVTYPE, -damage_by_event), y = damage_by_event)) + geom_bar(stat="Identity", fill="darkgreen") + theme_light(base_size = 11, base_family = "sans", base_line_size =1, base_rect_size = 1) + geom_text(aes(label=damage_by_event), vjust=-0.3, size=3.5) + xlab("Weather Event") + ylab("Total (US$)") + ggtitle("Top Five Weather Events for Total Damages for Property and Crop (US$)")
    print(g2)
```

   
# Conclusions
Overall, the weather events causing the most impact on population health via injuries and fatalities were Tornados(96,969) and excessive heat (9,428). When looking at economic consequences, flooding (US dollars 150,319,678,250) and hurricanes/typhoons (US dollars 71,913,712,800) caused the most damage to property and crops. 


